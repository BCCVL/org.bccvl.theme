<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      tal:omit-tag="">
  <script type="text/javascript"
          tal:content="structure view/js"></script>
  <div id="form-widgets-fieldname-selected"
       tal:attributes="id string:${view/id}-selected">
    <tal:repeat tal:repeat="item view/items">
      <div class="selecteditem"
           tal:define="layer item/layer;
                       brain item/brain;
                       index repeat/item/index;">
        <input type="hidden" value="" name="form.widgets.fieldname.dataset.0"
               tal:attributes="value brain/UID;
                               name string:${view/name}.dataset.${index};
                               "/>
        <input type="hidden" value="" name="form.widgets.fieldname.layer.0"
               tal:attributes="value layer/layer;
                               name string:${view/name}.layer.${index};
                               "/>
        <a class="btn pull-right" href="#"><i class="icon-remove"></i></a>
        <a class="fine bccvl-auto-viz btn btn-primary pull-right"
           title="preview this dataset"
           data-viz-id="vizurl"
           data-uuid="uuid"
           tal:attributes="data-viz-id item/vizurl;
                           data-uuid brain/UID;">
          <i class="icon-eye-open icon-link icon-white"></i>
        </a>
        <p><strong><span tal:content="brain/Title">Dataset</span></strong>
        <span tal:content="layer/label">Layer</span>
        </p>

      </div>
      <div class="selecteditem"
           tal:condition="repeat/item/end">
        <!-- TODO: should this one be outside of the div here?
             need to update load script to fetch it as well
             though -->
        <input type="hidden" value="" name="form.widgets.name.count"
               tal:attributes="value repeat/item/number;
                               name string:${view/name}.count"/>
        <input required="required" type="hidden" value="" name="form.widgets.empty" data-error-message="A dataset must be selected."
               tal:attributes="name string:${view/name}.empty;
                               value python: '1' if view.value else '';
                               required view/required;
                               id view/id" />
      </div>
    </tal:repeat>
    <div class="selecteditem empty"
         tal:condition="not:view/value">
      <input required="required" type="hidden" value="" name="form.widgets.empty" data-error-message="A dataset must be selected."
             tal:attributes="name string:${view/name}.empty;
                             value python: '1' if view.value else '';
                             required view/required;
                             id view/id" />
    </div>
  </div>
  <span class="loader-container" tal:condition="not:view/value">
    <img src="/bccvl/++resource++bccvl/images/bccvl-loader.gif" alt="BCCVL" class="loader"/>
  </span>
  <a id="fieldname-popup" href="#" class="btn btn-primary"
     tal:attributes="id string:${view/field/__name__}-popup"><i class="icon icon-white icon-plus-sign"></i> Select Available Datasets</a>
</html>
