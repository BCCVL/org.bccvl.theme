<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone.z3cform"
      tal:define="plone_view context/@@plone;
                  normalizeString nocall: context/plone_utils/normalizeString;
                  toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                  site_properties context/portal_properties/site_properties;
                  use_view_action site_properties/typesUseViewActionInListings|python:();
                  pas_member context/@@pas_member;
                  isAnon context/@@plone_portal_state/anonymous;
                  show_about python:not isAnon or site_properties.allowAnonymousViewAbout;
                  dummy python:request.response.setHeader('X-Theme-Disabled', 'True');

                  item_uuid context/@@uuid;
                  item python:context.portal_catalog.searchResults(UID=item_uuid)[0];

                  dataset_tools nocall:context/@@dataset_tools;

                  navigation_root_url context/@@plone_portal_state/navigation_root_url;

                  xitem_id item/getId|item/id;
                  xitem_type_title item/Type;
                  xitem_created item/CreationDate;
                  enable_layers python:request.get('datasets.filter.enable_layers', False);
                  "
      tal:omit-tag="">

  <div class="row-fluid">
    <form id="datasets-popup-searchform" action="" method="GET" class="span12"
          tal:define="context_state context/@@plone_context_state"
          tal:attributes="action context_state/current_base_url">
      <div class="row-fluid">
        <div class="span10">
          <div class="span3" tal:condition="enable_layers">
            <label for="datasets-filter-resolution">Choose a Resolution to Begin</label>
            <select id="datasets-filter-resolution"
                    name="datasets.filter.resolution:list"
                    multiple="multiple">
              <option value="resolutionid"
                      tal:repeat="opt view/resolution_list"
                      tal:attributes="selected opt/selected;
                                      disabled opt/disabled;
                                      value opt/token;"
                      tal:content="opt/label">Resolution title</option>
            </select>
          </div>
          <div class="span3">
            <label for="datasets-filter-text">Filter by Keywords</label>
            <input id="datasets-filter-text"
                   name="datasets.filter.text" type="text"
                   placeholder="Enter search terms." class="input-medium"
                   tal:attributes="value python:request.get('datasets.filter.text')"/>
            <input name="datasets.filter.genre:list" type="hidden"
                   tal:attributes="value genre"
                   tal:repeat="genre python:request.get('datasets.filter.genre')"/>

          </div>
          <div class="span3">
            <label for="datasets-filter-source">Filter by Source</label>
            <select id="datasets-filter-source"
                    name="datasets.filter.source:list"
                    multiple="multiple">

              <option value="optionvalue"
                      tal:repeat="opt view/source_list"
                      tal:attributes="selected opt/selected;
                                      disabled opt/disabled;
                                      value opt/token;"
                      tal:content="opt/label">Option label</option>
            </select>
          </div>
          <div class="span3"
               tal:condition="enable_layers">
            <input name="datasets.filter.enable_layers" type="hidden" value="1"/>
            <label for="datasets-filter-layer">Filter by Layers</label>
            <select id="datasets-filter-layer"
                    name="datasets.filter.layer:list"
                    multiple="multiple">

              <option value="layerid"
                      tal:repeat="opt view/layer_list"
                      tal:attributes="selected opt/selected;
                                      disabled opt/disabled;
                                      value opt/token;"
                      tal:content="opt/label">Layer title</option>
            </select>
          </div>
        </div>
        <div class="span2">
          <label for="datasets-filter-source">Apply Filters</label>
          <button class="btn btn-block" type="submit">Search!</button>
          <p tal:condition="enable_layers"><small>Select multiple layers by <strong>clicking checkboxes</strong> when clicking on results.</small></p>
          <p tal:condition="not:enable_layers"><small>Only <strong>one dataset</strong> can be selected here.</small></p>
        </div>
      </div>

    </form>
  </div>
  <div id="datasets-popup-result"
       tal:define="batch view/datasetslisting">
    <div id="datasets-popup-result-list">
      <div class="row" tal:condition="batch">
        <div class="cell">
          <div metal:use-macro="context/batch_macros/macros/navigation" />
        </div>
      </div>
      <tal:repeat tal:repeat="item batch">
      <!-- non layered datasets -->
      <div class="datasets-list-entry"
           tal:condition="not:enable_layers"
           tal:attributes="data-uuid item/UID"
           tal:define="item_title_or_id item/pretty_title_or_id;
                       item_icon python:plone_view.getIcon(item);
                       item_creator item/Creator;
                       item_modified item/ModificationDate;
                       item_description item/Description;
                       ">
        <div class="cell"
             tal:condition="not:enable_layers">
          <p class="lead">
            <input type="radio" name="selected-layer"
               tal:attributes="value string:select-${item/UID}" />
            <!--<img width="16" height="16"
               src="" alt=""
               tal:condition="item_icon/url"
               tal:attributes="src item_icon/url;
                               alt item_icon/description;
                               title item_icon/title;
                               width item_icon/width;
                               height item_icon/height;" />&nbsp;-->
            <span tal:content="item_title_or_id">Item Title</span></p>
          <p  tal:condition="item_description"
              tal:content="item_description">Item description</p>
          <p><strong>Creator:</strong> <span tal:condition="item_creator"
          tal:define="author python:pas_member.info(item_creator)"
          tal:content="author/name_or_id">Bob Dobalina</span>
          <strong>Modified:</strong> <span tal:content="python:toLocalizedTime(item_modified,long_format=1)">August 16, 2001 at 23:35:59</span>
          </p>
        </div>
      </div>
      <!-- layered datasets -->
      <div class="datasets-list-entry"
           tal:condition="enable_layers"
           tal:attributes="data-uuid item/UID;
                           data-layer layer/layer"
           tal:define="item_title_or_id item/pretty_title_or_id;
                       item_icon python:plone_view.getIcon(item);
                       item_creator item/Creator;
                       item_modified item/ModificationDate;
                       item_description item/Description;
                       md python:dataset_tools.metadata(item);
                       "
           tal:repeat="layer python:view.match_selectedlayers(md)">
        <div class="cell">

          <p class="lead">
            <input type="checkbox"
               tal:attributes="name item/UID;
                               value string:select-${item/UID};" />
            <!--<img width="16" height="16"
               src="" alt=""
               tal:condition="item_icon/url"
               tal:attributes="src item_icon/url;
                               alt item_icon/description;
                               title item_icon/title;
                               width item_icon/width;
                               height item_icon/height;" />&nbsp;-->
            <span tal:content="item_title_or_id">Item Title</span>
          </p>
          <p tal:condition="item_description"
              tal:content="item_description">Item description</p>
          <p  tal:condition="layer/label"
              tal:content="layer/label">Layer title</p>
          <p><strong>Creator:</strong> <span tal:condition="item_creator"
          tal:define="author python:pas_member.info(item_creator)"
          tal:content="author/name_or_id">Bob Dobalina</span></p>
          <p><strong>Modified:</strong> <span tal:content="python:toLocalizedTime(item_modified,long_format=1)">August 16, 2001 at 23:35:59</span></p>
        </div>
      </div>
    </tal:repeat>
    <div class="row" tal:condition="batch">
      <div class="cell">
        <div metal:use-macro="context/batch_macros/macros/navigation" />
      </div>
    </div>
    <div class="row"
         tal:condition="not:batch">
      <div class="alert alert-warning">
        <p><strong>No datasets match the resolution and filters above.</strong></p>
        <p>Try selecting a different resolution. You can also expand filters by holding CTRL (CMD on Mac) and selecting more in the same list.</p>
      </div>
    </div>
    </div>
  </div>
</html>
