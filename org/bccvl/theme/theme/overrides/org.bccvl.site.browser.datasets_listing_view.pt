<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
<head>
  <title>Datasets</title>
</head>
<body>

  <metal:content-core fill-slot="body">

  <ul id="datasets-nav" class="nav nav-tabs" metal:define-macro="datasets_tabs">
    <li class="tab-datasetslisting"
        tal:define="selected python: 'active' if view.__name__ == 'datasets_listing_view' else '';"
        tal:attributes="class string:tab-datasetslisting ${selected}">
      <a href="#"
         tal:attributes="href string:${context/absolute_url}"><span>Datasets</span></a>
    </li>
    <li class="tab-datasetsimport"
        tal:define="selected python: 'active' if view.__name__ == 'datasets_import_view' else '';"
        tal:attributes="class string:tab-datasetsimport ${selected}">
      <a href="#"
         tal:attributes="href string:${context/absolute_url}/datasets_import_view"><span>Discover Dataset</span></a>
    </li>
    <li class="tab-datasetsupload"
        tal:define="selected python: 'active' if view.__name__ == 'datasets_upload_view' else '';"
        tal:attributes="class string:tab-datasetsupload ${selected}">
      <a href="#"
         tal:attributes="href string:${context/absolute_url}/datasets_upload_view"><span>Upload Dataset</span></a>
    </li>
  </ul>


  <div id="datasets-filter" class="bccvl-datasetlist-filter row">
    <form action="" method="get" id="datasets-filter-form">
      <div class="span3">
        <p>Search</p>
        <div class="input-append">
          <input id="datasets-filter-text" name="datasets.filter.text"
                 type="text" placeholder="Search Datesets"
                 class="input-medium" tal:attributes="value python:request.get('datasets.filter.text')"/>
          <button class="btn" type="submit"><i class="icon-search"></i></button>
        </div>
        <button type="submit" name="datasets.filter.submit" id="datasets-filter-submit">Submit Filter</button>
        <button type="reset">Reset Filter</button>
      </div>
      <div class="span9">
        <p>Filter</p>
        <select id="datasets-filter-genre"
                name="datasets.filter.genre:list" multiple="multiple">
          <option disabled="disabled">Select a Genre</option>
          <option value="optionvalue"
                  tal:repeat="opt view/genre_list"
                  tal:attributes="selected opt/selected;
                                  disabled opt/disabled;
                                  value opt/token;"
                  tal:content="opt/label">Option label</option>
        </select>
        <select id="datasets-filter-resolution"
                name="datasets.filter.resolution:list"
                multiple="multiple"
                value="">
          <option disabled="disabled">Select a Resolution</option>
          <option value="optionvalue"
                  tal:repeat="opt view/resolution_list"
                  tal:attributes="selected opt/selected;
                                  disabled opt/disabled;
                                  value opt/token;"
                  tal:content="opt/label">Option label</option>
        </select>
        <select id="datasets-filter-source"
                name="datasets.filter.source:list"
                multiple="multiple">
          <option disabled="disabled">Select a Source</option>
          <option value="optionvalue"
                  tal:repeat="opt view/source_list"
                  tal:attributes="selected opt/selected;
                                  disabled opt/disabled;
                                  value opt/token;"
                  tal:content="opt/label">Option label</option>
        </select>
      </div>
    </form>
  </div>

  <div id="datasets-listing" metal:define-macro="datasets_list"
       tal:define="batch view/datasetslisting;
                   plone_view context/@@plone;
                   pas_member context/@@pas_member;
                   navigation_root_url context/@@plone_portal_state/navigation_root_url;
                   normalizeString nocall: context/plone_utils/normalizeString;
                   toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                   site_properties context/portal_properties/site_properties;
                   dataset_tools nocall:context/@@dataset_tools;
                   isAnon context/@@plone_portal_state/anonymous;
                   show_about python:not isAnon or site_properties.allowAnonymousViewAbout;">

    <div metal:use-macro="context/batch_macros/macros/navigation" />

    <div class="alert" tal:condition="not: batch">
      <p>No matches found</p>
    </div>

    <tal:condition tal:condition="batch">
      <tal:loop tal:repeat="item batch">
        <tal:define tal:define="item_title_or_id item/pretty_title_or_id;
                                item_icon python:plone_view.getIcon(item);
                                item_creator item/Creator;
                                item_modified item/ModificationDate;
                                item_url item/getURL|item/absolute_url;
                                item_description item/Description;
                                item_type item/portal_type;
                                item_type_class python:'contenttype-' + normalizeString(item_type);
                                item_genre item/BCCDataGenre;
                                item_genre_title python:dataset_tools.genre_title(item['BCCDataGenre']);
                                item_wf_state item/review_state|python: context.portal_workflow.getInfoFor(item, 'review_state', '');
                                item_wf_state_class python:'state-' + normalizeString(item_wf_state);
                                use_view_action site_properties/typesUseViewActionInListings|python:();
                                item_obj item/getObject;
                                "
                    metal:define-macro="datasets_listitem">
          <div class="datasets-list-entry" style="margin: 0 0 .5em;"
               tal:define="md item_obj/dataset_tools/metadata;
                           item_editable item_obj/dataset_tools/can_modify;">
            <div class="bccvl-table-label" style="padding:.5em .5em 0;margin:0;"
                 tal:define="author python:pas_member.info(item_creator)">
              <p class="lead" tal:content="item_title_or_id">Pig (Sus scrofa) occurrences</p>
              <p><small tal:content="item_description">Observed occurrences for Pig (Sus scrofa), imported from ALA on 08/09/2014</small></p>
              <p tal:condition="md/scientificname"><small><b>Species:</b> <tal:r tal:replace="md/scientificname">Sus scrofa</tal:r></small></p>
              <p tal:condition="md/rows"><small><b>rows:</b> <tal:r tal:replace="md/rows"></tal:r></small></p>
              <!-- <p tal:condition="md/width"><small><b>size:</b> <tal:r tal:replace="md/width"></tal:r>x<tal:r tal:replace="md/height"></tal:r></small></p> -->
              <!-- <p tal:condition="md/min"><small><b>min/max:</b> <tal:r tal:replace="md/min"></tal:r>/<tal:r tal:replace="md/max"></tal:r></small></p> -->
              <p tal:condition="md/resolution"><small><b>resolution: <tal:r tal:replace="md/resolution"></tal:r></b></small></p>
              <!-- <p tal:condition="md/crs"><small><b>crs:</b> <tal:r tal:replace="md/crs"></tal:r></small></p> -->
              <p><small><b>Owner:</b> <tal:r tal:replace="author/name_or_id">Me</tal:r></small></p>
              <p><small><b>Source:</b> ALA import</small></p>
              <p><small><b>Date:</b> <tal:r tal:replace="python:toLocalizedTime(item_modified,long_format=1)">Sep 07, 2014 11:20 PM</tal:r></small></p>
            </div>
            <div class="datasets-controls" style="background: none repeat scroll 0 0 rgba(0, 0, 0, 0.1);margin:0;padding:0 .5em .5em .5em;"
                 tal:define="complete python: item.job_state in ('COMPLETED', None)">
              <a class="dataset-info-btn" href="#" target="_blank"
                 tal:attributes="href string:${item_url}/details">
                <i class="icon-info-sign" title="More information for this dataset."></i>
              </a>
              <tal:block tal:define="dlinfo item_obj/dataset_tools/get_download_info"
                         tal:condition="complete">
                <a href="#"
                   tal:attributes="href dlinfo/url">
                  <i class="icon-circle-arrow-down" title="download"></i>
                </a>
                <a href="#" class="bccvl-occurrence-viz"
                   tal:attributes="data-viz-id python: dlinfo['alturl'][0];
                                   data-uuid item/UID"
                   tal:condition="python: item_obj.format == 'text/csv'">
                  <i class="icon-eye-open icon-link" title="preview"></i>
                </a>
                <a href="#" class="bccvl-auto-viz"
                   tal:attributes="data-viz-id python: dlinfo['alturl'][0];
                                   data-uuid item/UID"
                   tal:condition="python: item_obj.format != 'text/csv'">
                  <i class="icon-eye-open icon-link" title="preview"></i>
                </a>
              </tal:block>
              <a class="sharing-btn" href="#"
                 tal:attributes="href action/url"
                 tal:condition="python: complete and action.get('available')"
                 tal:define="action item_obj/dataset_tools/local_roles_action;">
                <i class="icon-share" title="Sharing Options"
                   tal:attributes="title action/title"></i>
              </a>
              <!-- TODO: should add helper method, to check whether this action is possible on this type of file/link content -->
              <a class="environmentallayers-zip-edit"
                 tal:attributes="href string:${item_url}/@@editfilemetadata"
                 tal:condition="python: item_editable and item_obj.format == 'application/zip'">
                <i class="icon-pencil" title="edit"></i>
              </a>
              <!-- TODO: helper method or customisable dict? or agree on classes? -->
              <tal:block
                  tal:define="state item/job_state;
                              klass python: 'icon-warning-sign' if state == 'FAILED' else 'dataset-import bccvl-small-spinner';
                              klass python: '' if state in (None, 'COMPLETED') else klass;
                              title python: 'Import failed' if state == 'FAILED' else 'Import in progress';
                              title python: '' if state in (None, 'COMPLETED') else title;">
                <i class="" data-url="" title=""
                   tal:condition="klass"
                   tal:attributes="data-url item_url;
                                   class klass;
                                   title title;"></i>
              </tal:block>
            </div>
          </div>

        </tal:define>
      </tal:loop>

      <tal:comment tal:content="nothing">
      <div id="fetch-more" tal:condition="batch/has_next"
           tal:define="batchview nocall:context/@@batchnavigation;
                       _batchview python:batchview(batch)">
        <a href="" tal:attributes="href
                                   python:batchview.make_link(batch.nextpage)"><span tal:omit-tag="">Next </span><span tal:omit-tag="" tal:content="batch/next_item_count">n</span> Items</a>
      </div>
      </tal:comment>
    </tal:condition>
    <div metal:use-macro="context/batch_macros/macros/navigation" />
  </div>


</metal:content-core>

</body>
</html>
