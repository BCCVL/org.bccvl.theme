<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<body>

<metal:content-core fill-slot="body"
                          tal:define="contentFilter view/contentFilter">

    <ul class="nav nav-tabs">
        <li id="tab-datasetslisting" class="active">
            <a href="#"
               tal:attributes="href string:${context/absolute_url}"><span>Datasets</span></a>
        </li>
        <li id="tab-datasetsimport">
            <a href="#"
               tal:attributes="href string:${context/absolute_url}/datasets_import_view"><span>Discover Dataset</span></a>
        </li>
        <li id="tab-datasetsupload">
            <a href="#"
               tal:attributes="href string:${context/absolute_url}/datasets_upload_view"><span>Upload Dataset</span></a>
        </li>
    </ul>

    <metal:content-core  use-macro="context/folder_listing/content-core">
        <metal:entries fill-slot="entries">
            <div metal:use-macro="context/batch_macros/macros/navigation" />
            <table class="table table-hover bccvl-datasetstable"
                   summary="Content listing"
                   i18n:attributes="summary summary_content_listing;">
                <thead>
                    <tr class="headers">
                      <th class="header headerSortUp">Date<span /></th>
                      <th>Summary<span /></th>
                      <th />
                    </tr>
                </thead>

                <tbody>
                    <metal:block use-macro="context/folder_listing/macros/entries">
                        <metal:entry fill-slot="entry">
                    <tr tal:define="oddrow repeat/item/odd;
                                    item_obj item/getObject;
                                    item_editable python:view.can_modify(item_obj);"
                        tal:attributes="class python: oddrow and 'even' or 'odd'">
                        <!-- Modified -->
                        <td tal:condition="show_about"
                            tal:content="python:toLocalizedTime(item_modified,long_format=1)">
                          August 16, 2001 at 23:35:59
                        </td>
                        <!-- Title -->
                        <td class="bccvl-table-label">
                          <h1 tal:content="item_title_or_id">Dataset title</h1>
                          <p tal:content="item_description">Dataset short description</p>
                        </td>
                        <!-- Actions -->
                        <!-- TODO: expects simple publication workflow
                        publish/retract -->
                        <td class="bccvl-table-controls"
                            tal:define="complete python: item.job_state in ('COMPLETED', None)">
                          <a tal:define="action python:view.get_transition(item_obj);
                                         icon_class python: action == 'publish' and 'icon-share-alt' or 'icon-remove';
                                         icon_title python: action == 'publish' and 'Publish' or 'Unpublish';"
                             tal:condition="python: complete and action"
                             tal:attributes="href string:${item_url}/dm/${icon_title}">
                             <i class="icon-share-alt" title="Publish"
                                tal:attributes="class icon_class;
                                                title icon_title"></i>
                          </a>

                          <a class="sharing-btn" href="#" tal:attributes="href action/url"
                             tal:condition="python: complete and action.get('available')"
                             tal:define="action python:view.local_roles_action(item_obj);">
                            <i class="icon-share" title="Sharing Options"
                               tal:attributes="title action/title"></i>
                          </a>

                          <tal:block tal:define="dlinfo python: view.get_download_info(item)">
                          <a href="#" tal:attributes="href dlinfo/url"
                             tal:condition="complete">
                            <i class="icon-circle-arrow-down" title="download"></i>
                          </a>
                          <a href="#" class="bccvl-occurrence-viz" tal:attributes="data-viz-id python: dlinfo['alturl'][0]"
                             tal:condition="python: complete and item_obj.content_type() == 'text/csv'">
                            <i class="icon-eye-open icon-link" title="preview"></i>
                          </a>

                          <a href="#" class="bccvl-auto-viz" tal:attributes="data-viz-id python: dlinfo['alturl'][0]"
                             tal:condition="python: complete and item_obj.content_type() != 'text/csv'">
                            <i class="icon-eye-open icon-link" title="preview"></i>
                          </a>
                      </tal:block>

                          <a class="environmentallayers-zip-edit" tal:attributes="href string:${item_url}/@@editfilemetadata"
                            tal:define="file item_obj/file|nothing"
                            tal:condition="python: item_editable and file and file.filename.endswith('.zip')">
                            <i class="icon-pencil" title="edit"></i>
                          </a>
                          <tal:block tal:define="state item/job_state;
                                                 klass python: 'dataset-import-failed' if state == 'FAILED' else 'dataset-import';
                                                 klass python: '' if state in (None, 'COMPLETED') else klass;
                                                 title python: 'Import failed' if state == 'FAILED' else 'Import in progress';
                                                 title python: '' if state in (None, 'COMPLETED') else title;
                                                 ">
                              <i class="" data-url="" title=""
                                 tal:condition="klass"
                                 tal:attributes="data-url item_url;
                                                 class klass;
                                                 title title;"></i>
                          </tal:block>

                        </td>

                    </tr>

                        </metal:entry>
                    </metal:block>
                </tbody>
            </table>

            </metal:entries>
    </metal:content-core>
</metal:content-core>

</body>
</html>
