<rules
    xmlns="http://namespaces.plone.org/diazo"
    xmlns:css="http://namespaces.plone.org/diazo/css"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <!-- EXPERIMENT LIST ============================================ -->
    <rules if-path="datasets">
        <theme href="html/dataset-list.html" />

        <!-- Breadcrumbs -->
        <after css:theme-children="ul.breadcrumb">
            <xsl:for-each select="//div[@id='portal-breadcrumbs']/span[@dir='ltr']">
                <li class="separator icon-chevron-right"></li>
                <li>
                    <xsl:element name="a">
                        <xsl:choose>
                            <xsl:when test="a">
                                <xsl:attribute name="href">
                                    <xsl:value-of select="a/@href" />
                                </xsl:attribute>
                                <xsl:value-of select="a" />
                            </xsl:when>
                            <xsl:otherwise>
                                <xsl:attribute name="href">.</xsl:attribute>
                                <xsl:value-of select="span" />
                            </xsl:otherwise>
                        </xsl:choose>
                    </xsl:element>
                </li>
            </xsl:for-each>
        </after>

        <!-- Datasets Navbar -->
        <before css:theme-children="div.bccvl-navtree" css:content="ul.navTreeLevel0" />

        <!-- Content of a page that is a leaf node -->
        <replace css:if-content="div#content" css:theme-children="div.bccvl-content" css:content="div#content" />

        <!--
        Get the list of datasets








        The experiments are listed inside #content-core as a definiton list.

        The dt contains the experiment title, its link, and its last modified time.

        The associated dl contains the experiment description.

        The date isn't easily captured, it is part of a string, with a great deal
        of excess whitespace, and the leading text "â€” last modified". We use
        normalize-space to clear out the excess leading and trailing spaces.
        We then use the substring command to skip the first 17 characters.
        -->
<!--         <before css:theme-children="section.bccvl-experimentlist table.bccvl-experimenttable > tbody">
            <xsl:for-each css:select="#content-core dt">
                <tr>
                    <td class="">
                        <xsl:copy-of select="substring(normalize-space(span[2]/text()[2]),17,21)" />
                    </td>
                    <td class="bccvl-table-label">
                        <h1><xsl:copy-of select="span/a/text()" /></h1>
                        <p><xsl:copy-of select="./following-sibling::dd[1]/span/text()" /></p>
                    </td>
                    <td class="bccvl-table-controls">
                        <xsl:element name="a">
                            <xsl:attribute name="href"><xsl:value-of select="string(span/a/@href)" /></xsl:attribute>
                            <i class="icon-chevron-right"></i>
                        </xsl:element>
                    </td>
                </tr>
            </xsl:for-each>
        </before>
 -->
    </rules>
</rules>
