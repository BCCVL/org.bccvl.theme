<rules
    xmlns="http://namespaces.plone.org/diazo"
    xmlns:css="http://namespaces.plone.org/diazo/css"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <!-- EXPERIMENT RESULTS ========================================= -->
    <rules css:if-content="#bccvl-experiment-view">
        <theme href="html/experiment-results.html" />

        <!-- get the experiment name for the breadcrumb trail from plone's breadcrumb trail -->
        <replace
            css:theme-children=".bccvl-breadcrumb .bccvllinks-experiment-view"
            css:content-children="#breadcrumbs-current"
        />

        <!-- update the job status -->

        <!--
            known possible statuses: Pending, Active, Performing Callbacks, Completed.

            template supported statuses: Active, Completed we'll use the template for
            all unknown statuses
        -->

        <!-- new plan: chuck everything and build a status block -->
        <drop css:theme=".bccvl-status-block" />

        <before css:theme-children=".bccvl-experimentresults">
            <xsl:choose>
                <xsl:when test="contains(//span[@id='form-widgets-IJobStatus-status']/text(),'Failed')">
                    <div class="row-fluid bccvl-status-block bccvl-status-error">
                        <div class="span12 bccvl-expstatus alert alert-block alert-error" data-status="Failed">
                            <p class="lead">This experiment stopped with an <strong>error</strong>.</p>
                        </div>
                    </div>
                </xsl:when>

                <xsl:when test="contains(//span[@id='form-widgets-IJobStatus-status']/text(),'New')">
                    <div class="row-fluid bccvl-status-block bccvl-status-running hidden">
                        <div class="span12 bccvl-expstatus alert alert-block" data-status="New">
                            <p>
                                This experiment is <strong class="alert-queued-text">queued</strong>.
                            </p>
                        </div>
                    </div>
                </xsl:when>

                <xsl:when test="contains(//span[@id='form-widgets-IJobStatus-status']/text(),'Queued')">
                    <div class="row-fluid bccvl-status-block bccvl-status-running hidden">
                        <div class="span12 bccvl-expstatus alert alert-block" data-status="Queued">
                            <p>
                                This experiment is <strong class="alert-queued-text">queued</strong>.
                            </p>
                        </div>
                    </div>
                </xsl:when>

                <xsl:when test="contains(//span[@id='form-widgets-IJobStatus-status']/text(),'Completed')
                                and not(contains(//span[@id='form-widgets-IJobStatus-status']/text(),'Queued'))
                                and not(contains(//span[@id='form-widgets-IJobStatus-status']/text(),'New'))
                                and not(contains(//span[@id='form-widgets-IJobStatus-status']/text(),'Failed'))
                                and not(contains(//span[@id='form-widgets-IJobStatus-status']/text(),'Transferring'))
                                and not(contains(//span[@id='form-widgets-IJobStatus-status']/text(),'Retrieving'))
                                and not(contains(//span[@id='form-widgets-IJobStatus-status']/text(),'Cleanup'))">
                    <div class="row-fluid bccvl-status-block bccvl-status-complete">
                        <div class="span12 bccvl-expstatus alert alert-success" data-status="Completed">
                            <p>
                                This experiment is <strong>complete</strong>. The results are available below.
                            </p>
                        </div>
                    </div>
                </xsl:when>

                <xsl:otherwise>
                    <div class="row-fluid bccvl-status-block bccvl-status-running hidden">
                        <div class="span12 bccvl-expstatus alert alert-block">
                            <p>
                                This experiment is <strong>running</strong>.
                            </p>
                        </div>
                    </div>
                </xsl:otherwise>
            </xsl:choose>
        </before>

        <!-- get the results -->
        <replace css:theme=".bccvl-experimentresults table"
                 css:content="#bccvl-experimentresults-table"/>

        <replace css:theme-children=".experiment-details" css:content-children="#fieldset-default"/>
        <replace css:theme-children=".experiment-configuration" css:content-children="#fieldset-parameters"/>

        <!-- place-holder ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    </rules>
</rules>
